(this["webpackJsonptest-deptrans-frontend"]=this["webpackJsonptest-deptrans-frontend"]||[]).push([[0],{105:function(e,t,r){},128:function(e,t,r){},129:function(e,t,r){},130:function(e,t,r){},133:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(15),c=r.n(a),l=r(24),s=(r(105),r(106),r(68)),o=r.n(s),u=r(80),d=function(e){return{type:"ADD_SOURCE",payload:{id:e.id,type:e.type,data:e.data}}},f=r(60),j=r(52),b=function(e){return function(t){t(function(e){return{type:"CLEAR_FILTERS",payload:{layerId:e}}}(e)),t(y(e))}},y=function(e){return function(t,r){var n=["all"],i=r().filters[e].filters,a=Object(j.groupBy)(i,(function(e){return e.fieldName}));for(var c in a)if(a.hasOwnProperty(c)){var l=a[c];if(l.length){var s=l.map((function(e){return e.expression})),o=["any"].concat(Object(f.a)(s));n.push(o)}}t(function(e,t){return{type:"CHANGE_RESULT_FILTER",payload:{layerId:e,resultExpression:t}}}(e,n))}},p=r(13),O=r(93),h=r(62),x=(r(126),[Object(p.a)(Object(p.a)({id:"countries",dataUrl:"/assets/countries.geojson",source:"countries"},{type:"fill",paint:{"fill-color":"#088","fill-opacity":.7,"fill-outline-color":"#fff"},layout:{visibility:"visible"}}),{},{filterFields:["CONTINENT","ECONOMY","INCOME_GRP"]}),Object(p.a)(Object(p.a)({id:"cities",dataUrl:"/assets/cities.geojson",source:"cities"},{type:"circle",paint:{"circle-color":"#000","circle-stroke-color":"#fff","circle-stroke-width":.5},layout:{visibility:"visible"}}),{},{filterFields:[]})]),m=r(7),v={fetchSourceData:function(e,t){return function(){var r=Object(u.a)(o.a.mark((function r(n){var i,a;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch(e);case 3:return i=r.sent,r.next=6,i.json();case 6:a=r.sent,n(d({id:t,type:"geojson",data:a})),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0);case 14:case"end":return r.stop()}}),r,null,[[0,11]])})));return function(e){return r.apply(this,arguments)}}()},addLayer:function(e){return function(t){t(function(e){return{type:"ADD_LAYER",payload:{id:e.id,source:e.id,type:e.type,paint:e.paint,layout:e.layout,filterFields:e.filterFields}}}(e))}},clearFilters:b},E=Object(l.b)((function(e){return{sources:e.sources,layers:e.layers,filters:e.filters}}),v)((function(e){var t=e.fetchSourceData,r=e.sources,a=e.layers,c=e.addLayer,l=e.filters,s=e.clearFilters,o=Object(n.useState)({latitude:0,longitude:0,zoom:1}),u=Object(O.a)(o,2),d=u[0],f=u[1];Object(n.useEffect)((function(){x.forEach((function(e){t(e.dataUrl,e.id),c({id:e.id,source:e.id,type:e.type,paint:e.paint,layout:e.layout,filterFields:e.filterFields}),s(e.id)}))}),[t,c,s]);return Object(m.jsx)(i.a.Fragment,{children:Object(m.jsxs)(h.c,Object(p.a)(Object(p.a)({style:{width:"100vw",height:"100vh"},mapStyle:"mapbox://styles/mapbox/light-v9",accessToken:"pk.eyJ1IjoieWFzZXZwbGF0b24iLCJhIjoiY2poaTJrc29jMDF0YzM2cDU1ZnM1c2xoMiJ9.FhmWdHG7ar14dQv1Aoqx4A"},d),{},{onViewportChange:f,children:[r.length&&r.map((function(e){var t=e.id,r=e.type,n=e.data;return Object(m.jsx)(h.b,{id:t,type:r,data:n},t)})),a.length&&a.map((function(e){var t=e.id,r=e.source,n=e.type,i=e.paint,a=e.layout;return Object(m.jsx)(h.a,{id:t,source:r,type:n,paint:i,layout:a,filter:l[t].resultExpression},t)}))]}))})})),I=(r(128),r(137)),g=i.a.memo((function(e){var t=e.layer,r=e.switchVisibility,i=Object(n.useCallback)((function(e){r(t.id)}),[r,t.id]);return Object(m.jsx)(I.a,{checked:"visible"===t.layout.visibility,onChange:i,children:t.id})})),F={switchVisibility:function(e){return function(t){t(function(e){return{type:"SWITCH_VISIBILITY",payload:{id:e}}}(e))}}},_=Object(l.b)(null,F)(g),N=i.a.memo((function(e){var t=e.layers;return Object(m.jsxs)("div",{className:"layers-group",children:[Object(m.jsx)("h3",{className:"text-align-center",children:"LAYERS"}),Object(m.jsx)("ul",{children:t.length&&t.map((function(e){return Object(m.jsx)("li",{children:Object(m.jsx)(_,{layer:e})},e.id)}))})]})})),T=Object(l.b)((function(e){return{layers:e.layers}}),null)(N),L=r(136),R=(r(129),r(135)),D=i.a.memo((function(e){var t=e.option,r=e.layer,n=e.fieldName,i=e.addFilter,a=e.removeFilter,c=e.filters,l="filter-".concat(r.id,"-").concat(n).concat("==").concat(t),s=c[r.id].filters,o=s.find((function(e){return e.id===l})),u=(o?s.indexOf(o):-1)>-1;return Object(m.jsx)(I.a,{defaultChecked:!1,checked:u,onChange:function(e){u?a(r.id,l):i(r.id,l,n,t,"==")},children:t})})),S={addFilter:function(e,t,r,n,i){return function(a){a(function(e,t,r,n,i){return{type:"ADD_FILTER",payload:{layerId:e,id:t,fieldName:r,fieldValue:n,expressionType:i,expression:[i,r,n]}}}(e,t,r,n,i)),a(y(e))}},removeFilter:function(e,t){return function(r){r(function(e,t){return{type:"REMOVE_FILTER",payload:{layerId:e,id:t}}}(e,t)),r(y(e))}}},w=Object(l.b)((function(e){return{filters:e.filters}}),S)(D),C=i.a.memo((function(e){var t=e.options,r=e.layer,n=e.fieldName,i=t.length&&t.sort();return Object(m.jsx)("ul",{children:t.length&&i.map((function(e,t){return Object(m.jsx)("li",{children:Object(m.jsx)(w,{option:e,layer:r,fieldName:n})},t)}))})})),A=(r(130),i.a.memo((function(e){var t=e.layer,r=e.source,a=e.clearFilters,c=e.filters,l=R.a.Text,s=r.data.features,o=t.filterFields,u=Object(n.useMemo)((function(){var e={};return o.forEach((function(t){e[t]=Object(j.groupBy)(s,(function(e){return e.properties[t]}))})),e}),[o,s]);return o.length?Object(m.jsxs)(i.a.Fragment,{children:[c[t.id].filters.length>0&&Object(m.jsx)(l,{type:"secondary",className:"btn--clear-filters",onClick:function(){a(t.id)},children:"clear all filters"}),Object(m.jsx)("ul",{children:o.map((function(e,r){var n=Object.keys(u[e]);return Object(m.jsxs)("li",{className:"filter-control",children:[Object(m.jsx)("b",{children:e}),Object(m.jsx)(C,{options:n,fieldName:e,layer:t})]},r)}))})]}):Object(m.jsx)("p",{children:"no filters"})}))),k={clearFilters:b},V=Object(l.b)((function(e){return{filters:e.filters}}),k)(A),U=i.a.memo((function(e){var t=e.layers,r=e.sources,n=L.a.Panel;return Object(m.jsx)(i.a.Fragment,{children:Object(m.jsxs)("div",{className:"filters-list",children:[Object(m.jsx)("h3",{className:"text-align-center",children:"FILTERS"}),Object(m.jsx)(L.a,{children:t.length&&t.map((function(e){var t=r.filter((function(t){return t.id===e.source}))[0];return Object(m.jsx)(n,{header:e.id,children:Object(m.jsx)(V,{layer:e,source:t})},e.id)}))})]})})})),M=Object(l.b)((function(e){return{layers:e.layers,sources:e.sources}}),null)(U),Y=i.a.memo((function(){return Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)(E,{}),Object(m.jsxs)("aside",{className:"side-menu",children:[Object(m.jsx)(T,{}),Object(m.jsx)(M,{})]})]})})),J=r(30),B=r(91),G=[],H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_LAYER":return e.concat(t.payload);case"SWITCH_VISIBILITY":return e.map((function(e){return e.id===t.payload.id?"visible"===e.layout.visibility?Object(p.a)(Object(p.a)({},e),{},{layout:Object(p.a)(Object(p.a)({},e.layout),{},{visibility:"none"})}):Object(p.a)(Object(p.a)({},e),{},{layout:Object(p.a)(Object(p.a)({},e.layout),{},{visibility:"visible"})}):e}));default:return e}},X=[],W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_SOURCE":return e.concat(t.payload);default:return e}},z=r(33),P={},Z=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case"ADD_FILTER":e=r.payload.layerId;var n={id:r.payload.id,expressionType:r.payload.expressionType,fieldName:r.payload.fieldName,fieldValue:r.payload.fieldValue,expression:r.payload.expression};return Object(p.a)(Object(p.a)({},t),{},Object(z.a)({},e,Object(p.a)(Object(p.a)({},t[e]),{},{filters:[].concat(Object(f.a)(t[e].filters),[n])})));case"REMOVE_FILTER":return e=r.payload.layerId,Object(p.a)(Object(p.a)({},t),{},Object(z.a)({},e,Object(p.a)(Object(p.a)({},t[e]),{},{filters:t[e].filters.filter((function(e){return e.id!==r.payload.id}))})));case"CHANGE_RESULT_FILTER":return e=r.payload.layerId,Object(p.a)(Object(p.a)({},t),{},Object(z.a)({},e,Object(p.a)(Object(p.a)({},t[e]),{},{resultExpression:r.payload.resultExpression})));case"CLEAR_FILTERS":return e=r.payload.layerId,Object(p.a)(Object(p.a)({},t),{},Object(z.a)({},e,Object(p.a)(Object(p.a)({},t[e]),{},{filters:[]})));default:return t}},q=Object(J.c)({sources:W,layers:H,filters:Z}),Q=Object(J.e)(q,Object(J.d)(Object(J.a)(B.a),window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__():function(e){return e}));c.a.render(Object(m.jsx)(l.a,{store:Q,children:Object(m.jsx)(Y,{})}),document.getElementById("root"))}},[[133,1,2]]]);
//# sourceMappingURL=main.a80dccdc.chunk.js.map